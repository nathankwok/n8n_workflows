{"updatedAt":"2025-12-20T04:17:20.990Z","createdAt":"2025-12-20T03:54:31.574Z","id":"QzzrCNPkQevDtQdv","name":"Board_Deck_Omni_Query_Analysis","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"omni-pattern-detection-subworkflow","responseMode":"responseNode","options":{}},"id":"webhook-trigger","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[48,0],"webhookId":"217b9060-06f9-49e5-b989-1ccca4bb41b7"},{"parameters":{"respondWith":"json","responseBody":"={{ \n{\n  \"status\": \"accepted\",\n  \"message\": \"Query received and processing started\",\n  \"timestamp\": new Date().toISOString()\n}\n}}","options":{"responseCode":202}},"id":"respond-to-webhook","name":"Acknowledge Request","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.5,"position":[304,0]},{"parameters":{"method":"POST","url":"https://cribl.omniapp.co/api/v1/query/run","authentication":"predefinedCredentialType","nodeCredentialType":"httpBearerAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"options":{}},"id":"run-omni-query","name":"Run Omni Query","type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[608,0],"retryOnFail":true,"maxTries":3,"waitBetweenTries":2000,"credentials":{"httpBearerAuth":{"id":"5VdIyCQ3QBhEpyIx","name":"Omni API"}},"onError":"continueErrorOutput"},{"parameters":{"promptType":"define","text":"=<task>\nAnalyze the following query results from Omni Analytics and identify patterns, trends, and key insights.\n\nProvide your analysis in structured JSON format with the following structure:\n{\n  \"insights\": [\n    {\n      \"category\": \"trend\" | \"pattern\" | \"anomaly\" | \"summary\",\n      \"title\": \"Brief title of the insight\",\n      \"description\": \"Detailed description of what was found\",\n      \"confidence\": \"high\" | \"medium\" | \"low\",\n      \"supporting_data\": [\"key data points that support this insight\"]\n    }\n  ],\n  \"summary\": \"Overall summary of the analysis\",\n  \"recommendations\": [\"actionable recommendations based on the patterns\"]\n}\n</task>\n\n<query_results>\n{{ $('Run Omni Query').item.json.data.toJsonString() }}\n</query_results>\n\n<context>\nOriginal Query:\n{{ $('Webhook').item.json.body.query.toJsonString() }}\n</context>","hasOutputParser":true,"options":{"systemMessage":"You are an expert data analyst specializing in pattern detection and business intelligence. You analyze query results to identify trends, patterns, anomalies, and actionable insights. You provide clear, concise analysis in structured JSON format."}},"id":"pattern-detection-agent","name":"Pattern Detection Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[912,-16]},{"parameters":{"model":"gpt-5-mini","options":{"responseFormat":"json_object"}},"id":"azure-openai-model","name":"Azure OpenAI GPT-5-mini","type":"@n8n/n8n-nodes-langchain.lmChatAzureOpenAi","typeVersion":1,"position":[912,192],"credentials":{"azureOpenAiApi":{"id":"ljEp6Un527XmKGRN","name":"Azure OpenAI gpt-5-mini"}}},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"insights\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"category\": {\"type\": \"string\"},\n          \"title\": {\"type\": \"string\"},\n          \"description\": {\"type\": \"string\"},\n          \"confidence\": {\"type\": \"string\"},\n          \"supporting_data\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}}\n        }\n      }\n    },\n    \"summary\": {\"type\": \"string\"},\n    \"recommendations\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}}\n  }\n}"},"id":"structured-output-parser","name":"Structured Output Parser","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[1104,192]},{"parameters":{"assignments":{"assignments":[{"id":"ai_insights","name":"ai_insights","type":"object","value":"={{ $('Pattern Detection Agent').item.json.output }}"},{"id":"query_results","name":"query_results","type":"object","value":"={{ $('Run Omni Query').item.json }}"},{"id":"original_query","name":"original_query","type":"object","value":"={{ $('Webhook').item.json.body.query }}"},{"id":"metadata","name":"metadata","type":"object","value":"={{ {\n  processedAt: new Date().toISOString(),\n  workflowExecutionId: $execution.id,\n  processingTimeMs: Date.now() - new Date($execution.startedAt).getTime()\n} }}"}]},"options":{}},"id":"combine-results","name":"Combine AI Insights with Raw Data","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1376,-16]},{"parameters":{"method":"POST","url":"={{ $('Webhook').item.json.headers.callbackurl }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $('Combine AI Insights with Raw Data').item.json }}","options":{}},"id":"send-results-callback","name":"Send Results to Callback URL","type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[1632,-16],"retryOnFail":true,"maxTries":3,"waitBetweenTries":3000},{"parameters":{"method":"POST","url":"={{ $('Webhook').item.json.headers.callbackurl }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"error\": true,\n  \"errorMessage\": {{ $json.message || 'Unknown error occurred' }},\n  \"errorDetails\": {{ $json.toJsonString() }},\n  \"original_query\": {{ $('Webhook').item.json.body.query.toJsonString() }},\n  \"timestamp\": {{ new Date().toISOString() }}\n}","options":{}},"id":"send-error-callback","name":"Send Error to Callback URL","type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[784,-240],"retryOnFail":true,"maxTries":2,"waitBetweenTries":2000},{"parameters":{"content":"```\n{\n  \"query\": {{ $('Webhook').item.json.body.query.toJsonString() }},\n  \"resultType\": \"json\",\n  \"userId\": {{ $('Webhook').item.json.body.userId || '893ce348-0fb2-44ac-b0f8-06521a341580' }}\n}\n```"},"type":"n8n-nodes-base.stickyNote","position":[352,336],"typeVersion":1,"id":"70ece11f-b114-4449-8b62-d0b8f1f87124","name":"Sticky Note"}],"connections":{"Webhook":{"main":[[{"node":"Acknowledge Request","type":"main","index":0}]]},"Acknowledge Request":{"main":[[{"node":"Run Omni Query","type":"main","index":0}]]},"Run Omni Query":{"main":[[{"node":"Pattern Detection Agent","type":"main","index":0}],[{"node":"Send Error to Callback URL","type":"main","index":0}]]},"Pattern Detection Agent":{"main":[[{"node":"Combine AI Insights with Raw Data","type":"main","index":0}],[]]},"Azure OpenAI GPT-5-mini":{"ai_languageModel":[[{"node":"Pattern Detection Agent","type":"ai_languageModel","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Pattern Detection Agent","type":"ai_outputParser","index":0}]]},"Combine AI Insights with Raw Data":{"main":[[{"node":"Send Results to Callback URL","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":null,"pinData":{},"versionId":"407960cb-3cd8-45b3-9e8a-c5fc86e12da2","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-20T03:54:31.577Z","createdAt":"2025-12-20T03:54:31.577Z","role":"workflow:owner","workflowId":"QzzrCNPkQevDtQdv","projectId":"2vHf2VxAoKk0WgJE"}],"activeVersion":null,"tags":[]}