{"updatedAt":"2025-12-21T08:16:40.000Z","createdAt":"2025-12-21T08:16:40.606Z","id":"IGgKir8Jk6PkquhI","name":"Board_Deck_Takeaways_set_nodes","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"908b0fb5-7887-4a42-8838-484e1a443abd","name":"When clicking 'Execute workflow'","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[112,304]},{"parameters":{"mode":"raw","jsonOutput":"{\n  \"dashboard_discovery_model_version\": \"1.0\",\n  \"snowflake_base_url\": \"https://ml16699-hya89079.snowflakecomputing.com\",\n  \"omni_documents_search_service\": {\n    \"snowflake_database\": \"ANALYTICS\",\n    \"snowflake_schema\": \"OMNI\",\n    \"service_name\": \"omni_documents_search_service\"\n  },\n  \"omni_api\": {\n    \"omni_base_url\": \"https://cribl.omniapp.co\",\n    \"model_id\": \"4345b118-cbbe-4f7c-a705-ea0aa8da57c0\"\n  },\n  \"snowflake_tables\": {\n    \"omni_documents\": {\n      \"snowflake_database\": \"ANALYTICS\",\n      \"snowflake_schema\": \"OMNI\",\n      \"table_name\": \"DOCUMENTS\"\n    },\n    \"dashboard_recommendations\": {\n      \"snowflake_database\": \"RAW\",\n      \"snowflake_schema\": \"OMNI\",\n      \"table_name\": \"DASHBOARD_RECOMMENDATIONS\"\n    }\n  }\n}","includeOtherFields":true,"include":"except","excludeFields":"headers,params,query,webhookUrl,executionMode","options":{}},"id":"cd05ff5f-d97c-4f6b-b2d0-d47b9ae88bba","name":"Global Vars","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[304,304]},{"parameters":{"mode":"raw","jsonOutput":"{\n  \"56a414f9-4bc9-4d41-958a-9f5652389081\": [\n    {\n      \"drill_name\": \"upsell_opps\",\n      \"query\": {\n        \"limit\": 1000,\n        \"table\": \"sales__opportunity\",\n        \"fields\": [\"sales__accounts.account_name\", \"sales__opportunity.opportunity_name\"]\n      },\n      \"sql\": \"SELECT * FROM sales__opportunity\"\n    },\n    {\n      \"drill_name\": \"new_opps\",\n      \"query\": {\n        \"limit\": 1000,\n        \"table\": \"sales__opportunity\",\n        \"fields\": [\"sales__accounts.account_name\"]\n      },\n      \"sql\": \"SELECT * FROM sales__opportunity WHERE type='new'\"\n    }\n  ]\n}","includeOtherFields":true,"options":{}},"id":"2098f7af-21a4-4544-bdd6-7f04bdf3640f","name":"Load Drill Queries","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,304]},{"parameters":{"assignments":{"assignments":[{"id":"filtered_data","name":"filtered_data","type":"object","value":"={{ Object.fromEntries(Object.entries($json).filter(([key, value]) => !['headers', 'params', 'query', 'webhookUrl', 'executionMode'].includes(key) && Array.isArray(value))) }}"}]},"options":{}},"id":"2be7c659-e948-49bc-a6e8-2e0d27742f55","name":"Filter System Fields","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[704,304]},{"parameters":{"options":{"reset":false}},"id":"6b7021ea-f761-4fe3-a769-5fc57f483b1c","name":"Loop Over UUIDs","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1104,304]},{"parameters":{"fieldToSplitOut":"uuid_items[0].queries","include":"allOtherFields","options":{"disableDotNotation":false,"destinationFieldName":""}},"id":"3a66b376-5baf-43fa-93f8-b285b8e25baf","name":"Expand Queries Array","type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[1568,272],"disabled":true},{"parameters":{"options":{"reset":true}},"id":"2130b18d-1a42-4a1c-a016-6be484482bf5","name":"Loop Over Queries","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1760,640]},{"parameters":{"assignments":{"assignments":[{"id":"uuid","name":"uuid","type":"string","value":"={{ $json.uuid }}"},{"id":"drill_name","name":"drill_name","type":"string","value":"={{ $json.drill_name }}"},{"id":"query","name":"query","type":"object","value":"={{ $json.query || {} }}"}]},"options":{}},"id":"865494c6-2458-47d5-820f-2241eb83a98d","name":"Format Request Body","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1968,784]},{"parameters":{"method":"POST","url":"https://n8n-relayer-1.app.n8n.cloud/webhook/omni-pattern-detection-subworkflow","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"callbackurl","value":"={{ $execution.resumeUrl }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ {\n  query: $json.query,\n  userId: $json.userId || '893ce348-0fb2-44ac-b0f8-06521a341580'\n} }}","options":{}},"id":"e43318c6-3730-44e5-a48c-c24a85bf3bdb","name":"POST Drill Query","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2160,784]},{"parameters":{"amount":1,"path":"21a92d52-586d-4a5b-8bbc-7d948830fa9f"},"id":"669c1783-564e-446d-abba-b1d33f4d8227","name":"Wait Between Requests","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2368,928],"webhookId":"21a92d52-586d-4a5b-8bbc-7d948830fa9f"},{"parameters":{"assignments":{"assignments":[{"id":"uuid_items","name":"uuid_items","type":"array","value":"={{ Object.entries($json.filtered_data).map(([uuid, queries]) => ({ uuid, queries, queryCount: queries.length })) }}"}]},"options":{}},"id":"ecc20571-77fb-45ec-bef7-c8fc94e37130","name":"Transform to UUID Array","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[912,304]},{"parameters":{"jsCode":"const currentItem = $input.first().json;\n\n  if (!currentItem.uuid || !currentItem.queries) {\n    return [{\n      json: {\n        error: 'Missing required fields: uuid or queries',\n        received: currentItem\n      }\n    }];\n  }\n\n  const uuid = currentItem.uuid;\n  const queries = currentItem.queries;\n\n  if (!Array.isArray(queries)) {\n    return [{\n      json: {\n        error: 'queries is not an array',\n        type: typeof queries\n      }\n    }];\n  }\n\n  return queries.map(query => ({\n    json: {\n      uuid: uuid,\n      drill_name: query.drill_name || 'unnamed_drill',\n      query: query.query || {},\n      sql: query.sql || ''\n    }\n  }));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1408,480],"id":"e28893b9-21c1-4b32-8a83-06da5c200c0d","name":"Code in JavaScript"}],"connections":{"When clicking 'Execute workflow'":{"main":[[{"node":"Global Vars","type":"main","index":0}]]},"Global Vars":{"main":[[{"node":"Load Drill Queries","type":"main","index":0}]]},"Load Drill Queries":{"main":[[{"node":"Filter System Fields","type":"main","index":0}]]},"Loop Over UUIDs":{"main":[[],[{"node":"Code in JavaScript","type":"main","index":0}]]},"Expand Queries Array":{"main":[[]]},"Loop Over Queries":{"main":[[{"node":"Loop Over UUIDs","type":"main","index":0}],[{"node":"Format Request Body","type":"main","index":0}]]},"Format Request Body":{"main":[[{"node":"POST Drill Query","type":"main","index":0}]]},"POST Drill Query":{"main":[[{"node":"Wait Between Requests","type":"main","index":0}]]},"Wait Between Requests":{"main":[[{"node":"Loop Over Queries","type":"main","index":0}]]},"Filter System Fields":{"main":[[{"node":"Transform to UUID Array","type":"main","index":0}]]},"Transform to UUID Array":{"main":[[{"node":"Loop Over UUIDs","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Loop Over Queries","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":null,"pinData":{},"versionId":"3207c5b6-75ff-4e92-a0ec-5ce2609f1e60","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-21T08:16:40.610Z","createdAt":"2025-12-21T08:16:40.610Z","role":"workflow:owner","workflowId":"IGgKir8Jk6PkquhI","projectId":"2vHf2VxAoKk0WgJE"}],"activeVersion":null,"tags":[]}