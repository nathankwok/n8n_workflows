{
  "createdAt": "2025-09-23T07:33:17.693Z",
  "updatedAt": "2025-09-23T22:12:17.997Z",
  "id": "d0l6ZepnDYgKyq5P",
  "name": "Snowflake Cortex Analyst Subworkflow",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Global Vars').item.json.snowflake_base_url }}/api/v2/cortex/threads",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\"origin_application\": \"slack_bot\"}",
        "options": {}
      },
      "id": "create-cortex-thread",
      "name": "Create Cortex Thread",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        624,
        0
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "2l2T0gIHT5WIzG0w",
          "name": "Firecrawl Auth Header"
        },
        "httpBearerAuth": {
          "id": "PnKZCKVe26AxmdDj",
          "name": "Snowflake API"
        }
      }
    },
    {
      "parameters": {
        "inputSource": "jsonExample",
        "jsonExample": "{\n  \"message\": \"user prompt\",\n  \"snowflake_base_url\": \"https://ml16699-hya89079.snowflakecomputing.com\"\n}"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        0,
        0
      ],
      "id": "ff22f0c3-42bc-4ff7-8555-177dee86c310",
      "name": "Trigger",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"omni_documents_analyst_agent\": {\n    \"snowflake_database\": \"SNOWFLAKE_INTELLIGENCE\",\n    \"snowflake_schema\": \"AGENTS\",\n    \"agent_name\": \"OMNI_DOCUMENTS_ANALYST_AGENT\"\n  }\n}\n",
        "includeOtherFields": true,
        "include": "selected",
        "includeFields": "message,snowflake_base_url",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        304,
        0
      ],
      "id": "e8378d5d-c522-4f49-b64b-51f95cc72a9e",
      "name": "Global Vars"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Global Vars').item.json.snowflake_base_url }}/api/v2/databases/{{ $('Global Vars').item.json.omni_documents_analyst_agent.snowflake_database }}/schemas/{{ $('Global Vars').item.json.omni_documents_analyst_agent.snowflake_schema }}/agents/{{ $('Global Vars').item.json.omni_documents_analyst_agent.agent_name }}:run",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"thread_id\": {{ $('Create Cortex Thread').item.json.thread_id }},\n  \"parent_message_id\": 0,\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": [\n        {\n          \"type\": \"text\",\n          \"text\": \"{{ $('Global Vars').item.json.message }}\"\n        }\n      ]\n    }\n  ],\n  \"tool_choice\": {\n    \"type\": \"auto\"\n  }\n}",
        "options": {}
      },
      "id": "send-agent-request",
      "name": "Send Agent Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        944,
        0
      ],
      "alwaysOutputData": false,
      "credentials": {
        "httpBearerAuth": {
          "id": "PnKZCKVe26AxmdDj",
          "name": "Snowflake API"
        }
      }
    }
  ],
  "connections": {
    "Trigger": {
      "main": [
        [
          {
            "node": "Global Vars",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Global Vars": {
      "main": [
        [
          {
            "node": "Create Cortex Thread",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Cortex Thread": {
      "main": [
        [
          {
            "node": "Send Agent Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Agent Request": {
      "main": [
        []
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {
    "Trigger": [
      {
        "json": {
          "message": "customer breakdown",
          "snowflake_base_url": "https://ml16699-hya89079.snowflakecomputing.com"
        }
      }
    ],
    "Global Vars": [
      {
        "json": {
          "message": "customer breakdown",
          "snowflake_base_url": "https://ml16699-hya89079.snowflakecomputing.com",
          "omni_documents_analyst_agent": {
            "snowflake_database": "SNOWFLAKE_INTELLIGENCE",
            "snowflake_schema": "AGENTS",
            "agent_name": "OMNI_DOCUMENTS_ANALYST_AGENT"
          }
        }
      }
    ]
  },
  "versionId": "e1037201-1dff-4de4-8e55-4bbc77a6349c",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-09-23T07:33:17.693Z",
      "updatedAt": "2025-09-23T07:33:17.693Z",
      "role": "workflow:owner",
      "workflowId": "d0l6ZepnDYgKyq5P",
      "projectId": "w7JTueqTYNrmBYZn"
    }
  ],
  "tags": []
}